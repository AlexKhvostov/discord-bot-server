# Discord Bot API

Простой API для взаимодействия с Discord ботом, предоставляющий функционал для работы с пользователями сервера и отправки сообщений.

## Содержание

- [Функциональность](#функциональность)
- [Установка](#установка)
- [Конфигурация](#конфигурация)
- [Запуск](#запуск)
- [API Документация](#api-документация)
- [Тестирование](#тестирование)
- [CI/CD](#cicd)
- [Безопасность](#безопасность)
- [Технологии](#технологии)
- [Лицензия](#лицензия)

## Функциональность

### Основные возможности
- Получение списка пользователей сервера
- Отправка сообщений в канал
- Поддержка упоминаний пользователей и ролей
- Автоматическое форматирование сообщений

### Детали реализации
- REST API на Express.js
- Аутентификация через Discord токен
- Поддержка переменных окружения
- Тестирование с Jest
- CI/CD через GitHub Actions

## Установка

### Предварительные требования
- Node.js 18.x или выше
- npm 7.x или выше
- Discord бот с необходимыми правами
- Доступ к серверу Discord

### Шаги установки
1. Клонируйте репозиторий:
```bash
git clone https://github.com/AlexKhvostov/discord-bot-server.git
cd discord-bot-server
```

2. Установите зависимости:
```bash
npm install
```

## Конфигурация

### Переменные окружения
Создайте файл `.env` в корне проекта со следующими переменными:

```env
# Токен бота Discord
DISCORD_TOKEN=your_bot_token

# ID сервера Discord
GUILD_ID=your_guild_id

# ID канала для отправки сообщений
CHANNEL_ID=your_channel_id
```

### Получение токена бота
1. Перейдите на [Discord Developer Portal](https://discord.com/developers/applications)
2. Создайте новое приложение
3. Перейдите в раздел "Bot"
4. Скопируйте токен

### Получение ID сервера и канала
1. В Discord включите режим разработчика (Настройки -> Дополнительно -> Режим разработчика)
2. Правый клик на сервере/канале -> Копировать ID

## Запуск

### Режим разработки
```bash
npm run dev
```
Сервер запустится на http://localhost:3000

### Продакшн режим
```bash
npm start
```

## API Документация

### Базовый URL
```
http://localhost:3000
```

### Эндпоинты

#### Получение списка пользователей
```
GET /users
```

**Ответ:**
```json
[
  {
    "id": "string",
    "username": "string",
    "nickname": "string | null",
    "avatar": "string",
    "roles": [
      {
        "id": "string",
        "name": "string",
        "color": "string"
      }
    ]
  }
]
```

#### Отправка сообщения
```
POST /messages
```

**Тело запроса:**
```json
{
  "content": "string",
  "mentions": {
    "users": ["string"],
    "roles": ["string"]
  }
}
```

**Ответ:**
```json
{
  "success": boolean,
  "messageId": "string"
}
```

### Коды ошибок
- `400` - Неверный запрос
- `401` - Не авторизован
- `403` - Доступ запрещен
- `404` - Ресурс не найден
- `500` - Внутренняя ошибка сервера

## Тестирование

### Запуск тестов
```bash
npm test
```

### Структура тестов
- Базовые тесты эндпоинтов
- Проверка обработки ошибок
- Валидация входных данных

## CI/CD

### GitHub Actions
- Автоматический запуск тестов при пуше
- Проверка на main ветке
- Тестирование на Node.js 18.x

### Workflow
1. Установка зависимостей
2. Запуск тестов
3. Отчет о результатах

## Безопасность

### Рекомендации
1. Храните токен бота в переменных окружения
2. Не публикуйте `.env` файл
3. Используйте HTTPS в продакшене
4. Ограничьте доступ к API

### Права бота
- Чтение сообщений
- Отправка сообщений
- Управление ролями
- Просмотр участников

## Технологии

### Основной стек
- Node.js
- Express.js
- Discord.js
- Jest
- GitHub Actions

### Зависимости
```json
{
  "dependencies": {
    "discord.js": "^14.14.1",
    "dotenv": "^16.4.1",
    "express": "^4.18.2",
    "cors": "^2.8.5"
  },
  "devDependencies": {
    "nodemon": "^3.0.3",
    "jest": "^29.7.0",
    "supertest": "^6.3.4"
  }
}
```

## Лицензия

Проект распространяется под лицензией MIT. Подробности в файле [LICENSE](LICENSE). 